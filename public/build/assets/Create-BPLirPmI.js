import{i as b,d as U,c as E,o as n,w,a as e,f as i,h as c,k as m,g as H,t as d,e as y,q as k,G as M,b as I,j as $,S as z,E as A,W as R}from"./app-Bwvq5oqN.js";import{_ as N}from"./AppLayout-DrB-Fbu4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"min-h-screen bg-gray-50 py-6"},G={class:"max-w-4xl mx-auto px-4"},L={class:"bg-white rounded-lg shadow"},D={class:"p-6 space-y-6"},F={key:1,class:"border border-gray-300 rounded-lg p-4 flex items-center justify-between"},W={class:"flex items-center"},q={class:"font-medium"},O={class:"text-sm text-gray-500"},X={key:2,class:"mt-2 text-sm text-red-600"},K={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-4"},J={class:"flex"},Z={class:"text-sm text-red-800"},Q={key:0,class:"mt-1 text-sm text-red-600"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ee={key:0,class:"mt-1 text-sm text-red-600"},te={class:"flex items-center space-x-4"},oe={key:0,class:"relative"},se=["src"],le={class:"bg-gray-50 px-6 py-4 flex justify-between"},re=["disabled"],ae={key:0,class:"mt-6 bg-white rounded-lg shadow p-6"},ne={class:"flex justify-between items-center mb-2"},ie={class:"text-sm text-gray-500"},de={class:"w-full bg-gray-200 rounded-full h-2"},me={__name:"Create",setup(ue){const o=b({title:"",description:"",video:null,thumbnail:null,category:"",status:"published",tags:""}),a=b({}),v=b(!1),u=b(0),f=b(null),h=U(()=>o.value.video&&o.value.title.trim()&&o.value.category&&o.value.status),V=l=>{const t=l.target.files[0];t&&(o.value.video=t,o.value.title||(o.value.title=t.name.replace(/\.[^/.]+$/,"")))},B=()=>{var l,t;o.value.video=null,o.value.title===((t=(l=o.value.video)==null?void 0:l.name)==null?void 0:t.replace(/\.[^/.]+$/,""))&&(o.value.title="")},C=l=>{const t=l.target.files[0];if(t){o.value.thumbnail=t;const s=new FileReader;s.onload=r=>{f.value=r.target.result},s.readAsDataURL(t)}},S=()=>{o.value.thumbnail=null,f.value=null},_=l=>{const t=["Bytes","KB","MB","GB"];if(l===0)return"0 Bytes";const s=Math.floor(Math.log(l)/Math.log(1024));return Math.round(l/Math.pow(1024,s)*100)/100+" "+t[s]},j=async()=>{var l,t,s;if(h.value){v.value=!0,a.value={},u.value=0;try{const r=new FormData;r.append("title",o.value.title),r.append("description",o.value.description),r.append("video",o.value.video),o.value.thumbnail&&r.append("thumbnail",o.value.thumbnail),r.append("category",o.value.category),r.append("status",o.value.status),r.append("tags",o.value.tags),console.log("Upload data:",{title:o.value.title,category:o.value.category,status:o.value.status,videoSize:(l=o.value.video)==null?void 0:l.size,videoType:(t=o.value.video)==null?void 0:t.type});const T=setInterval(()=>{u.value<90&&(u.value+=Math.random()*10)},500),p=await fetch(route("video.store"),{method:"POST",body:r,headers:{"X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"",Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(clearInterval(T),u.value=100,console.log("Response status:",p.status),console.log("Response headers:",p.headers),!p.ok){const x=await p.text();throw console.error("Error response:",x),new Error(`HTTP ${p.status}: ${x.substring(0,200)}...`)}const g=await p.json();if(console.log("Response data:",g),g.success)console.log("Upload successful, redirecting..."),v.value=!1,alert("動画のアップロードが完了しました！"),setTimeout(()=>{try{R.visit(route("video.manage"))}catch(x){console.error("Navigation error:",x),window.location.href=route("video.manage")}},500);else throw g.errors&&(a.value=g.errors),new Error(g.message||"アップロードに失敗しました")}catch(r){console.error("Upload error:",r),v.value=!1,u.value=0,r.name==="SyntaxError"&&r.message.includes("Unexpected token")?a.value={general:"サーバーエラーが発生しました。ページを再読み込みして再試行してください。"}:a.value={general:r.message||"アップロードに失敗しました"}}}};return(l,t)=>(n(),E(N,{title:"動画をアップロード"},{default:w(()=>[e("div",P,[e("div",G,[t[22]||(t[22]=e("div",{class:"bg-white rounded-lg shadow p-6 mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 flex items-center"},[e("svg",{class:"w-8 h-8 text-red-500 mr-3",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M14,13h-3v3H9v-3H6v-2h3V8h2v3h3v2z"})]),m(" 動画をアップロード ")]),e("p",{class:"text-gray-600 mt-2"},"あなたの動画を世界中の人々と共有しましょう")],-1)),e("div",L,[e("form",{onSubmit:H(j,["prevent"]),enctype:"multipart/form-data"},[e("div",D,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" 動画ファイル "),e("span",{class:"text-red-500"},"*")],-1)),o.value.video?(n(),i("div",F,[e("div",W,[t[7]||(t[7]=e("svg",{class:"w-8 h-8 text-blue-500 mr-3",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})],-1)),e("div",null,[e("p",q,d(o.value.video.name),1),e("p",O,d(_(o.value.video.size)),1)])]),e("button",{type:"button",onClick:B,class:"text-red-500 hover:text-red-700"},t[8]||(t[8]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):(n(),i("div",{key:0,class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-red-400",onClick:t[0]||(t[0]=s=>l.$refs.videoInput.click())},t[6]||(t[6]=[e("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1),e("p",{class:"text-lg font-medium text-gray-700"},"動画ファイルを選択",-1),e("p",{class:"text-gray-500"},"MP4, AVI, MOV, WMV, WebM (最大1GB)",-1)]))),e("input",{ref:"videoInput",type:"file",onChange:V,accept:"video/*",class:"hidden"},null,544),a.value.video?(n(),i("div",X,d(a.value.video),1)):c("",!0)]),a.value.general?(n(),i("div",K,[e("div",J,[t[10]||(t[10]=e("svg",{class:"w-5 h-5 text-red-400 mr-2 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",Z,d(a.value.general),1)])])):c("",!0),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" タイトル "),e("span",{class:"text-red-500"},"*")],-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.title=s),type:"text",maxlength:"255",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"魅力的なタイトルを入力してください"},null,512),[[k,o.value.title]]),a.value.title?(n(),i("div",Q,d(a.value.title),1)):c("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"説明",-1)),y(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.description=s),rows:"4",maxlength:"5000",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"動画の内容について説明してください"},null,512),[[k,o.value.description]])]),e("div",Y,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" カテゴリ "),e("span",{class:"text-red-500"},"*")],-1)),y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.category=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"},t[13]||(t[13]=[e("option",{value:""},"選択してください",-1),e("option",{value:"gaming"},"ゲーム",-1),e("option",{value:"music"},"音楽",-1),e("option",{value:"education"},"教育",-1),e("option",{value:"entertainment"},"エンターテイメント",-1),e("option",{value:"sports"},"スポーツ",-1),e("option",{value:"technology"},"テクノロジー",-1),e("option",{value:"news"},"ニュース",-1),e("option",{value:"lifestyle"},"ライフスタイル",-1),e("option",{value:"comedy"},"コメディ",-1),e("option",{value:"food"},"料理・グルメ",-1)]),512),[[M,o.value.category]]),a.value.category?(n(),i("div",ee,d(a.value.category),1)):c("",!0)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[m(" 公開設定 "),e("span",{class:"text-red-500"},"*")],-1)),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.status=s),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"},t[15]||(t[15]=[e("option",{value:"published"},"公開",-1),e("option",{value:"unlisted"},"限定公開",-1),e("option",{value:"private"},"非公開",-1)]),512),[[M,o.value.status]])])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"サムネイル（オプション）",-1)),e("div",te,[f.value?(n(),i("div",oe,[e("img",{src:f.value,alt:"サムネイル",class:"w-32 h-18 object-cover rounded border"},null,8,se),e("button",{type:"button",onClick:S,class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1"},t[17]||(t[17]=[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):c("",!0),e("button",{type:"button",onClick:t[5]||(t[5]=s=>l.$refs.thumbnailInput.click()),class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"}," サムネイルを選択 ")]),e("input",{ref:"thumbnailInput",type:"file",onChange:C,accept:"image/*",class:"hidden"},null,544),t[19]||(t[19]=e("p",{class:"mt-1 text-sm text-gray-500"},"推奨サイズ: 1280x720px (JPEG, PNG, GIF)",-1))])]),e("div",le,[I($(z),{href:l.route("dashboard"),class:"text-gray-600 hover:text-gray-800"},{default:w(()=>t[20]||(t[20]=[m("キャンセル")])),_:1,__:[20]},8,["href"]),e("button",{type:"submit",disabled:!h.value||v.value,class:"bg-red-500 text-white px-6 py-2 rounded-lg hover:bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed"},d(v.value?"アップロード中...":"動画をアップロード"),9,re)])],32)]),v.value?(n(),i("div",ae,[e("div",ne,[t[21]||(t[21]=e("span",{class:"text-sm font-medium"},"アップロード進捗",-1)),e("span",ie,d(u.value)+"%",1)]),e("div",de,[e("div",{class:"bg-red-500 h-2 rounded-full",style:A({width:u.value+"%"})},null,4)])])):c("",!0)])])]),_:1}))}};export{me as default};
